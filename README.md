# Immich Job Daemon

**–†—É—Å—Å–∫–∏–π | [English](README.en.md)**

[![Docker Build](https://github.com/alternativniy/immich-job-daemon/actions/workflows/docker-build.yml/badge.svg)](https://github.com/alternativniy/immich-job-daemon/actions/workflows/docker-build.yml)
[![License: MIT](https://img.shields.io/badge/License-MIT-yellow.svg)](https://opensource.org/licenses/MIT)
[![Docker Pulls](https://img.shields.io/docker/pulls/alternativniy/immich-job-daemon)](https://github.com/alternativniy/immich-job-daemon/pkgs/container/immich-job-daemon)

–î–µ–º–æ–Ω –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –æ—á–µ—Ä–µ–¥—å—é –∑–∞–¥–∞–Ω–∏–π Immich. –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —É–ø—Ä–∞–≤–ª—è–µ—Ç –∑–∞–¥–∞–Ω–∏—è–º–∏ –ø–æ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç—É, –ø–æ–∑–≤–æ–ª—è—è –∑–∞–ø—É—Å–∫–∞—Ç—å –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ –∑–∞–¥–∞–Ω–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–¥–∞–Ω–∏–π.

## –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏

- üêß –û—Å–Ω–æ–≤–∞–Ω –Ω–∞ Alpine Linux (–º–∏–Ω–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä –æ–±—Ä–∞–∑–∞)
- üîÑ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–∞–º–∏ –∑–∞–¥–∞–Ω–∏–π
- ‚öôÔ∏è –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –∑–∞–¥–∞–Ω–∏–π
- üîí –ó–∞–ø—É—Å–∫ –æ—Ç –Ω–µ–ø—Ä–∏–≤–∏–ª–µ–≥–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- üåê –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —á–µ—Ä–µ–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

## –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç –∑–∞–¥–∞–Ω–∏–π

–ó–∞–¥–∞–Ω–∏—è –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è –≤ —Å–ª–µ–¥—É—é—â–µ–º –ø–æ—Ä—è–¥–∫–µ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–∞:

1. sidecar
2. metadataExtraction
3. storageTemplateMigration
4. thumbnailGeneration
5. smartSearch
6. duplicateDetection
7. faceDetection
8. facialRecognition
9. videoConversion
10. other jobs

## –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

### –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –≥–æ—Ç–æ–≤–æ–≥–æ –æ–±—Ä–∞–∑–∞ –∏–∑ GitHub Container Registry

```bash
docker run -d \
  --name immich-job-daemon \
  -e IMMICH_URL=http://your-immich-server:2283 \
  -e API_KEY=your_api_key_here \
  -e MAX_CONCURRENT_JOBS=2 \
  --restart unless-stopped \
  ghcr.io/alternativniy/immich-job-daemon:latest
```

### –°–±–æ—Ä–∫–∞ –æ–±—Ä–∞–∑–∞ –ª–æ–∫–∞–ª—å–Ω–æ

#### Docker Run

```bash
docker build -t immich-job-daemon .

docker run -d \
  --name immich-job-daemon \
  -e IMMICH_URL=http://your-immich-server:2283 \
  -e API_KEY=your_api_key_here \
  -e MAX_CONCURRENT_JOBS=2 \
  --restart unless-stopped \
  immich-job-daemon
```

### Docker Compose

1. –û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ `docker-compose.yml`:
   ```yaml
   services:
     immich-job-daemon:
       image: ghcr.io/alternativniy/immich-job-daemon:latest
       # –ò–ª–∏ —Å–æ–±–µ—Ä–∏—Ç–µ –ª–æ–∫–∞–ª—å–Ω–æ:
       # build: .
       container_name: immich-job-daemon
       restart: unless-stopped
       environment:
         - IMMICH_URL=http://127.0.0.1:2283
         - API_KEY=your_api_key_here
         - MAX_CONCURRENT_JOBS=2
       depends_on:
         - immich-server
       networks:
         - immich_network
   ```

2. –ó–∞–ø—É—Å—Ç–∏—Ç–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä:
   ```bash
   docker-compose up -d
   ```

> **üìù –ü—Ä–∏–º–µ—á–∞–Ω–∏–µ:** –î–µ–º–æ–Ω –∑–∞–≤–∏—Å–∏—Ç –æ—Ç `immich-server` –∏ –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –≤ —Ç–æ–π –∂–µ Docker —Å–µ—Ç–∏ –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ API.

## –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

| –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è | –û–ø–∏—Å–∞–Ω–∏–µ | –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é | –û–±—è–∑–∞—Ç–µ–ª—å–Ω–∞—è |
|-----------|----------|--------------|--------------|
| `IMMICH_URL` | URL —Å–µ—Ä–≤–µ—Ä–∞ Immich | `http://127.0.0.1:2283` | –ù–µ—Ç |
| `API_KEY` | API –∫–ª—é—á Immich —Å —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è–º–∏ `job.read` –∏ `job.create` | - | **–î–∞** |
| `MAX_CONCURRENT_JOBS` | –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ –≤—ã–ø–æ–ª–Ω—è–µ–º—ã—Ö –∑–∞–¥–∞–Ω–∏–π | `1` | –ù–µ—Ç |
| `POLL_INTERVAL` | –ò–Ω—Ç–µ—Ä–≤–∞–ª –æ–ø—Ä–æ—Å–∞ –≤ —Å–µ–∫—É–Ω–¥–∞—Ö | `10` | –ù–µ—Ç |

## –ü–æ–ª—É—á–µ–Ω–∏–µ API –∫–ª—é—á–∞

1. –í–æ–π–¥–∏—Ç–µ –≤ –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å Immich
2. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ **Account Settings** ‚Üí **API Keys**
3. –°–æ–∑–¥–∞–π—Ç–µ –Ω–æ–≤—ã–π API –∫–ª—é—á —Å —Ç—Ä–µ–±—É–µ–º—ã–º–∏ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è–º–∏:
   - ‚úÖ `job.read` - –¥–ª—è —á—Ç–µ–Ω–∏—è —Å—Ç–∞—Ç—É—Å–∞ –∑–∞–¥–∞–Ω–∏–π
   - ‚úÖ `job.create` - –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∑–∞–¥–∞–Ω–∏—è–º–∏ (pause/resume)
4. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ –∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –µ–≥–æ –≤ –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π `API_KEY`

> **‚ö†Ô∏è –í–∞–∂–Ω–æ:** API –∫–ª—é—á –¥–æ–ª–∂–µ–Ω –∏–º–µ—Ç—å —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è `job.read` –∏ `job.create`, –∏–Ω–∞—á–µ –¥–µ–º–æ–Ω –Ω–µ —Å–º–æ–∂–µ—Ç —É–ø—Ä–∞–≤–ª—è—Ç—å –∑–∞–¥–∞–Ω–∏—è–º–∏.

## –õ–æ–≥–∏

–ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞:

```bash
docker logs -f immich-job-daemon
```

## –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç

–î–µ–º–æ–Ω –∫–∞–∂–¥—ã–µ N —Å–µ–∫—É–Ω–¥ (–Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ `POLL_INTERVAL`):

1. –ü–æ–ª—É—á–∞–µ—Ç —Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –∑–∞–¥–∞–Ω–∏–π –∏–∑ Immich API
2. **–ü—Ä–æ–≤–µ—Ä—è–µ—Ç –Ω–∞–ª–∏—á–∏–µ –∞–∫—Ç–∏–≤–Ω–æ –≤—ã–ø–æ–ª–Ω—è—é—â–∏—Ö—Å—è –∑–∞–¥–∞–Ω–∏–π** (active > 0)
3. **–ï—Å–ª–∏ –µ—Å—Ç—å –∞–∫—Ç–∏–≤–Ω—ã–µ –∑–∞–¥–∞–Ω–∏—è** - –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç –∏—Ö –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –¥–æ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è (–Ω–µ –ø—Ä–µ—Ä—ã–≤–∞–µ—Ç)
4. **–ï—Å–ª–∏ –≤—Å–µ –∑–∞–¥–∞–Ω–∏—è –Ω–∞ –ø–∞—É–∑–µ** - –Ω–∞—Ö–æ–¥–∏—Ç –ø–µ—Ä–≤—ã–µ N –∑–∞–¥–∞–Ω–∏–π –∏–∑ —Å–ø–∏—Å–∫–∞ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–æ–≤ (–≥–¥–µ N = `MAX_CONCURRENT_JOBS`), —É –∫–æ—Ç–æ—Ä—ã—Ö –µ—Å—Ç—å –∑–∞–¥–∞—á–∏ –≤ –æ—á–µ—Ä–µ–¥–∏
5. –í–æ–∑–æ–±–Ω–æ–≤–ª—è–µ—Ç –≤—ã–±—Ä–∞–Ω–Ω—ã–µ –∑–∞–¥–∞–Ω–∏—è
6. –ü—Ä–∏–æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç –≤—Å–µ –æ—Å—Ç–∞–ª—å–Ω—ã–µ —É–ø—Ä–∞–≤–ª—è–µ–º—ã–µ –∑–∞–¥–∞–Ω–∏—è

–≠—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ —É–ø—Ä–∞–≤–ª—è—Ç—å —Ä–µ—Å—É—Ä—Å–∞–º–∏ —Å–µ—Ä–≤–µ—Ä–∞, –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—è –∑–∞–¥–∞–Ω–∏—è –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ –∏–ª–∏ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ –ø–æ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç—É, **–ø—Ä–∏ —ç—Ç–æ–º –Ω–µ –ø—Ä–µ—Ä—ã–≤–∞—è —É–∂–µ –≤—ã–ø–æ–ª–Ω—è—é—â–∏–µ—Å—è –∑–∞–¥–∞—á–∏**.

### üîÑ –õ–æ–≥–∏–∫–∞ —Ä–∞–±–æ—Ç—ã —Å –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–∞–º–∏

**–í–∞–∂–Ω–æ:** –î–µ–º–æ–Ω –Ω–µ –ø—Ä–µ—Ä—ã–≤–∞–µ—Ç –≤—ã–ø–æ–ª–Ω—è—é—â–∏–µ—Å—è –∑–∞–¥–∞–Ω–∏—è! –≠—Ç–æ –∫—Ä–∏—Ç–∏—á–Ω–æ –¥–ª—è –∑–∞–¥–∞–Ω–∏–π, –∫–æ—Ç–æ—Ä—ã–µ –≥–µ–Ω–µ—Ä–∏—Ä—É—é—Ç –¥–∞–Ω–Ω—ã–µ –¥–ª—è –¥—Ä—É–≥–∏—Ö –∑–∞–¥–∞–Ω–∏–π.

**–ü—Ä–∏–º–µ—Ä:**
- –í—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –∑–∞–¥–∞–Ω–∏–µ `thumbnailGeneration` (–ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç 4)
- –ü–æ—è–≤–ª—è—é—Ç—Å—è –¥–∞–Ω–Ω—ã–µ –¥–ª—è `metadataExtraction` (–ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç 2, –≤—ã—à–µ)
- –î–µ–º–æ–Ω **–ù–ï –ø—Ä–µ—Ä–≤–µ—Ç** `thumbnailGeneration`, –¥–∞—Å—Ç –µ–º—É –∑–∞–≤–µ—Ä—à–∏—Ç—å—Å—è
- –ü–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –≤—Å–µ—Ö –∞–∫—Ç–∏–≤–Ω—ã—Ö –∑–∞–¥–∞–Ω–∏–π –∑–∞–ø—É—Å—Ç–∏—Ç `metadataExtraction` –ø–æ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç—É

**–ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è:**
- `MAX_CONCURRENT_JOBS=1` - –∑–∞–¥–∞–Ω–∏—è –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è —Å—Ç—Ä–æ–≥–æ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)
- `MAX_CONCURRENT_JOBS=2` - –¥–≤–∞ –∑–∞–¥–∞–Ω–∏—è –º–æ–≥—É—Ç –≤—ã–ø–æ–ª–Ω—è—Ç—å—Å—è –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ
- `MAX_CONCURRENT_JOBS=3` - —Ç—Ä–∏ –∑–∞–¥–∞–Ω–∏—è –º–æ–≥—É—Ç –≤—ã–ø–æ–ª–Ω—è—Ç—å—Å—è –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ

## –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

- Docker –∏–ª–∏ Docker Compose
- **–ó–∞–ø—É—â–µ–Ω–Ω—ã–π —Å–µ—Ä–≤–µ—Ä Immich** (–∫–æ–Ω—Ç–µ–π–Ω–µ—Ä `immich-server`)
- –î–æ—Å—Ç—É–ø –∫ Immich API
- –î–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã–π API –∫–ª—é—á Immich —Å —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è–º–∏ `job.read` –∏ `job.create`
- –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–æ–ª–∂–µ–Ω –Ω–∞—Ö–æ–¥–∏—Ç—å—Å—è –≤ —Ç–æ–π –∂–µ Docker —Å–µ—Ç–∏, —á—Ç–æ –∏ Immich

## –õ–∏—Ü–µ–Ω–∑–∏—è

MIT
